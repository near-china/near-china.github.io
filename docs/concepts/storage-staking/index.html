<!DOCTYPE html><html lang="en"><head><meta charSet="utf-8"/><meta http-equiv="X-UA-Compatible" content="IE=edge"/><title>Storage Staking · NEAR中文文档</title><meta name="viewport" content="width=device-width"/><meta name="generator" content="Docusaurus"/><meta name="description" content="&gt; When you deploy a smart contract to NEAR, you pay for the storage that this contract requires using a mechanism called storage staking."/><meta name="docsearch:language" content="en"/><meta property="og:title" content="Storage Staking · NEAR中文文档"/><meta property="og:type" content="website"/><meta property="og:url" content="https://docs.near.org.cn/https://docs.near.org.cn/"/><meta property="og:description" content="&gt; When you deploy a smart contract to NEAR, you pay for the storage that this contract requires using a mechanism called storage staking."/><meta property="og:image" content="https://docs.near.org.cn/https://docs.near.org.cn/img/near_logo.svg"/><meta name="twitter:card" content="summary"/><meta name="twitter:image" content="https://docs.near.org.cn/https://docs.near.org.cn/img/near_logo.svg"/><link rel="shortcut icon" href="https://docs.near.org.cn/img/favicon.ico"/><link rel="stylesheet" href="https://cdn.jsdelivr.net/docsearch.js/1/docsearch.min.css"/><link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/atom-one-dark.min.css"/><script>
              (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
              (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
              m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
              })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

              ga('create', 'G-BJYH0DD65K', 'auto');
              ga('send', 'pageview');
            </script><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;900&amp;family=Source+Code+Pro:ital,wght@0,400;0,600;1,400;1,600&amp;display=swap"/><link rel="stylesheet" href="/css/copy-code-button.css"/><link rel="stylesheet" href="/css/landing-page.css"/><link rel="stylesheet" href="https://near.org/wp-content/themes/near-19/assets/dist/near.min.css?t=1601063158&amp;#038;ver=5.4.2"/><script type="text/javascript" src="https://buttons.github.io/buttons.js"></script><script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.0/clipboard.min.js"></script><script type="text/javascript" src="https://use.fontawesome.com/221fd444f5.js"></script><script type="text/javascript" src="/js/copy-code-button.js"></script><script type="text/javascript" src="/js/mixpanel.js"></script><script src="https://docs.near.org.cn/js/scrollSpy.js"></script><link rel="stylesheet" href="https://docs.near.org.cn/css/main.css"/><script src="https://docs.near.org.cn/js/codetabs.js"></script></head><body class="sideNavVisible separateOnPageNav"><div class="fixedHeaderContainer"><div class="headerWrapper wrapper"><header><a href="https://docs.near.org.cn/"><img class="logo" src="https://docs.near.org.cn/img/near_logo.svg" alt="NEAR中文文档"/></a><div class="navigationWrapper navigationSlider"><nav class="slidingNav"><ul class="nav-site nav-site-internal"><li class="siteNavGroupActive"><a href="https://docs.near.org.cn/docs/concepts/new-to-near" target="_self">概述</a></li><li class=""><a href="https://docs.near.org.cn/docs/develop/basics/getting-started" target="_self">开发</a></li><li class=""><a href="https://docs.near.org.cn/docs/tools/near-cli" target="_self">工具</a></li><li class=""><a href="https://docs.near.org.cn/docs/tutorials/create-transactions" target="_self">教程</a></li><li class="navSearchWrapper reactNavSearchWrapper"><input type="text" id="search_input_react" placeholder="搜索文档..." title="搜索文档..."/></li><li class=""><a href="https://docs.near.org.cn/docs/community/community-channels" target="_self">社区</a></li><li class=""><a href="https://docs.near.org.cn/docs/tokens/token-custody" target="_self">通证</a></li><li class=""><a href="https://docs.near.org.cn/docs/validator/staking-overview" target="_self">质押</a></li><li class=""><a href="https://docs.near.org.cn/docs/roles/integrator/exchange-integration" target="_self">集成</a></li><li class=""><a href="https://github.com/near-china/near-china.github.io/issues" target="_blank">GitHub</a></li></ul></nav></div></header></div></div><div class="navPusher"><div class="docMainWrapper wrapper"><div class="docsNavContainer" id="docsNav"><nav class="toc"><div class="toggleNav"><section class="navWrapper wrapper"><div class="navBreadcrumb wrapper"><div class="navToggle" id="navToggler"><div class="hamburger-menu"><div class="line1"></div><div class="line2"></div><div class="line3"></div></div></div><h2><i>›</i><span>基本</span></h2><div class="tocToggler" id="tocToggler"><i class="icon-toc"></i></div></div><div class="navGroups"><div class="navGroup"><h3 class="navGroupCategoryTitle">总览</h3><ul class=""><li class="navListItem"><a class="navItem" href="https://docs.near.org.cn/docs/concepts/new-to-near">New to NEAR?</a></li></ul></div><div class="navGroup"><h3 class="navGroupCategoryTitle">基本</h3><ul class=""><li class="navListItem"><a class="navItem" href="https://docs.near.org.cn/docs/concepts/account">Account</a></li><li class="navListItem"><a class="navItem" href="https://docs.near.org.cn/docs/concepts/data-storage">Data Storage</a></li><li class="navListItem navListItemActive"><a class="navItem" href="https://docs.near.org.cn/docs/concepts/storage-staking">Storage Staking</a></li><li class="navListItem"><a class="navItem" href="https://docs.near.org.cn/docs/concepts/epoch">Epoch</a></li><li class="navListItem"><a class="navItem" href="https://docs.near.org.cn/docs/concepts/gas">Gas</a></li><li class="navListItem"><a class="navItem" href="https://docs.near.org.cn/docs/concepts/networks">Networks</a></li><li class="navListItem"><a class="navItem" href="https://docs.near.org.cn/docs/concepts/transaction">Transaction</a></li></ul></div><div class="navGroup"><h3 class="navGroupCategoryTitle">结构</h3><ul class=""><li class="navListItem"><a class="navItem" href="https://docs.near.org.cn/docs/concepts/architecture/specification">Specification</a></li><li class="navListItem"><a class="navItem" href="https://docs.near.org.cn/docs/concepts/architecture/papers">Papers</a></li></ul></div></div></section></div><script>
            var coll = document.getElementsByClassName('collapsible');
            var checkActiveCategory = true;
            for (var i = 0; i < coll.length; i++) {
              var links = coll[i].nextElementSibling.getElementsByTagName('*');
              if (checkActiveCategory){
                for (var j = 0; j < links.length; j++) {
                  if (links[j].classList.contains('navListItemActive')){
                    coll[i].nextElementSibling.classList.toggle('hide');
                    coll[i].childNodes[1].classList.toggle('rotate');
                    checkActiveCategory = false;
                    break;
                  }
                }
              }

              coll[i].addEventListener('click', function() {
                var arrow = this.childNodes[1];
                arrow.classList.toggle('rotate');
                var content = this.nextElementSibling;
                content.classList.toggle('hide');
              });
            }

            document.addEventListener('DOMContentLoaded', function() {
              createToggler('#navToggler', '#docsNav', 'docsSliderActive');
              createToggler('#tocToggler', 'body', 'tocActive');

              var headings = document.querySelector('.toc-headings');
              headings && headings.addEventListener('click', function(event) {
                var el = event.target;
                while(el !== headings){
                  if (el.tagName === 'A') {
                    document.body.classList.remove('tocActive');
                    break;
                  } else{
                    el = el.parentNode;
                  }
                }
              }, false);

              function createToggler(togglerSelector, targetSelector, className) {
                var toggler = document.querySelector(togglerSelector);
                var target = document.querySelector(targetSelector);

                if (!toggler) {
                  return;
                }

                toggler.onclick = function(event) {
                  event.preventDefault();

                  target.classList.toggle(className);
                };
              }
            });
        </script></nav></div><div class="container mainContainer docsContainer"><div class="wrapper"><div class="post"><header class="postHeader"><a class="edit-page-link button" href="https://github.com/near-china/near-china.github.io/tree/zh_CN/docs/concepts/storage-staking.md" target="_blank" rel="noreferrer noopener">Edit</a><h1 id="__docusaurus" class="postHeaderTitle">Storage Staking</h1></header><article><div><span><blockquote>
<p>When you deploy a smart contract to NEAR, you pay for the storage that this contract requires using a mechanism called storage staking.</p>
<p>In storage staking (sometimes called <em>state</em> staking), the account that owns a smart contract must stake (or lock) tokens according to the amount of data stored in that smart contract, effectively reducing the balance of the contract's account.</p>
</blockquote>
<blockquote class="info">
<strong>Coming from Ethereum?</strong><br><br>
<p>If you’re familiar with Ethereum’s pricing model, you may know that, like NEAR, the protocol charges a fee (called &quot;gas&quot;) for each transaction. Unlike NEAR, Ethereum's gas fee accounts for the amount of data stored via that transaction. This essentially means that anyone can pay once to store permanent data on-chain. This is a poor economic design for at least two reasons: 1. The people running the network (miners, in the case of Ethereum 1) are not appropriately incentivized to store large amounts of data, since a gas fee far charged in the distant past can increase storage costs forever, and 2. The users of a smart contract are charged for the data they send to store in it, rather than charging the owner of the smart contract.</p>
</blockquote>
<h2><a class="anchor" aria-hidden="true" id="how-does-nears-design-align-incentives"></a><a href="#how-does-nears-design-align-incentives" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>How does NEAR's design align incentives?</h2>
<p>Storage-staked tokens are unavailable for other uses, such as validation staking. This increases the yield that validators will receive. Learn more in <a href="https://near.org/papers/economics-in-sharded-blockchain/">the economics whitepaper</a>.</p>
<h2><a class="anchor" aria-hidden="true" id="when-do-tokens-get-staked"></a><a href="#when-do-tokens-get-staked" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>When do tokens get staked?</h2>
<p>On each incoming transaction that adds data.</p>
<p>Let's walk through an example:</p>
<ol>
<li>You launch <a href="https://examples.near.org/guest-book">a guest book app</a>, deploying your app's smart contract to the account <code>example.near</code></li>
<li>Visitors to your app can add messages to the guest book. This means your users will, <a href="/docs/concepts/gas#what-about-prepaid-gas">by default</a>, pay a small gas fee to send their message to your contract.</li>
<li>When such a call comes in, NEAR will check that <code>example.near</code> has a large enough balance that it can stake an amount to cover the new storage needs. If it does not, the transaction will fail.</li>
</ol>
<h2><a class="anchor" aria-hidden="true" id="the-million-cheap-data-additions-attack"></a><a href="#the-million-cheap-data-additions-attack" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>The &quot;million cheap data additions&quot; attack</h2>
<p>Note that this can create an attack surface. To continue the example above, if sending data to your guest book costs users close to nothing while costing the contract owner significantly more, then a malicious user can exploit the imbalance to make maintaining the contract prohibitively expensive.</p>
<p>Take care, then, when designing your smart contracts to ensure that such attacks cost potential attackers more than it would be worth.</p>
<h2><a class="anchor" aria-hidden="true" id="btw-you-can-remove-data-to-unstake-some-tokens"></a><a href="#btw-you-can-remove-data-to-unstake-some-tokens" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>btw, you can remove data to unstake some tokens</h2>
<p>People familiar with the &quot;immutable data&quot; narrative about blockchains find this surprising. While it's true that an <em>indexing node</em> will keep all data forever, <em>validating nodes</em> (that is, the nodes run by most validators in the network) do not. Smart contracts can provide ways to delete data, and this data will be purged from most nodes in the network within a few <a href="/docs/concepts/epoch">epochs</a>.</p>
<p>Note that a call to your smart contract to remove data has an associated gas fee. Given NEAR's gas limit, this creates an upper limit on how much data can be deleted in a single transaction.</p>
<h2><a class="anchor" aria-hidden="true" id="how-much-does-it-cost"></a><a href="#how-much-does-it-cost" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>How much does it cost?</h2>
<p>Storage staking is priced in an amount set by the network, which was initialized to <strong><a href="https://github.com/near/nearcore/blob/2141bdafc57def7793708dcfcbf6aaea4c56e2c5/neard/res/mainnet_genesis.json#L32">1E20 yoctoNEAR per byte</a></strong>, or <strong>10kb per NEAR token (Ⓝ)</strong></p>
<p>This value may change in the future. NEAR's JSON RPC API provides <a href="/docs/develop/front-end/rpc#genesis-config">a way to query this initial setting</a>, but does not yet provide a way to query the &quot;live&quot; configuration value. Before it changes, this document will be updated to include information about how to query the live version.</p>
<h2><a class="anchor" aria-hidden="true" id="example-cost-breakdown"></a><a href="#example-cost-breakdown" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Example cost breakdown</h2>
<p>Let's walk through an example.</p>
<p>A <a href="https://github.com/nearprotocol/NEPs/pull/4">non-fungible token</a> is unique, which means each token has its own ID. The contract must store a mapping from token IDs to owners' account ID.</p>
<p>If such an NFT is used to track <strong>1 million</strong> tokens, how much storage will be required for the token-ID-to-owner mapping? And how many tokens will need to be staked for that storage?</p>
<p>Using <a href="https://github.com/near-examples/NFT/tree/master/contracts/assemblyscript/nep4-basic">this basic AssemblyScript implementation</a> as inspiration, let's calculate the storage needs when using a <a href="https://near.github.io/near-sdk-as/classes/_sdk_core_assembly_collections_persistentmap_.persistentmap.html"><code>PersistentMap</code></a> from <code>near-sdk-as</code>. While its specific implementation may change in the future, at the time of writing <code>near-sdk-as</code> stored data as UTF-8 strings. We'll assume this below.</p>
<p>Here's our <code>PersistentMap</code>:</p>
<pre><code class="hljs css language-ts"><span class="hljs-keyword">type</span> AccountId = <span class="hljs-built_in">string</span>
<span class="hljs-keyword">type</span> TokenId = u64
<span class="hljs-keyword">const</span> tokenToOwner = <span class="hljs-keyword">new</span> PersistentMap&lt;TokenId, AccountId&gt;(<span class="hljs-string">'t2o'</span>)
</code></pre>
<p>Behind the scenes, all data stored on the NEAR blockchain is saved in a key-value database. That <code>'t2o'</code> variable that's passed to <code>PersistentMap</code> helps it keep track of all its values. If your account <code>example.near</code> owns token with ID <code>0</code>, then at the time of writing, here's the data that would get saved to the key-value database:</p>
<ul>
<li>key: <code>t2o::0</code></li>
<li>value: <code>example.near</code></li>
</ul>
<p>So for 1 million tokens, here are all the things we need to add up and multiply by 1 million:</p>
<ol>
<li>The prefix, <code>t2o</code>, will be serialized as three bytes in UTF-8, and the two colons will add another two. That's 5 bytes.</li>
<li>For an implementation where <code>TokenId</code> auto-increments, the values will be between <code>0</code> and <code>999999</code>, which makes the average length 5 bytes.</li>
<li>Let's assume well-formed NEAR <code>AccountId</code>s, and let's guess that NEAR Account IDs follow the approximate pattern of domain names, which <a href="https://www.domainregistration.com.au/news/2013/1301-domain-length.php">average about 10 characters</a>, plus a top-level name like <code>.near</code>. So a reasonable average to expect might be about 15 characters; let's keep our estimate pessimistic and say 25. This will equal 25 bytes, since NEAR account IDs must use characters from the ASCII set.</li>
</ol>
<p>So:</p>
<pre><code class="hljs">1_000_000 * (5 + 5 + 25)
</code></pre>
<p>35 million bytes. Multiplying by 1e20 yoctoNEAR per byte, we find that the <code>tokenToOwner</code> mapping will require staking 3.5e27 yoctoNEAR, or Ⓝ3,500</p>
<p>Note that you can get this down to Ⓝ3,300 just by changing the prefix from <code>t2o</code> to a single character. Or get rid of it entirely! You can have a zero-length prefix on one <code>PersistentVector</code> in your smart contract. If you did that with this one, you could get it down to Ⓝ3.2</p>
<h2><a class="anchor" aria-hidden="true" id="calculate-costs-for-your-own-contract"></a><a href="#calculate-costs-for-your-own-contract" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Calculate costs for your own contract</h2>
<p>Doing manual byte math as shown above is difficult and error-prone. Good news: you don't have to!</p>
<p>You can test storage used right in your unit tests:</p>
<ul>
<li>Using <a href="https://near.github.io/near-sdk-as"><code>near-sdk-as</code></a>, import <code>env</code> and check <code>env.storage_usage()</code> – <a href="https://github.com/near/near-sdk-as/blob/b308aa48e0bc8336b458f05a231409be4dee6c69/sdk/assembly/__tests__/runtime.spec.ts#L156-L200">example</a></li>
</ul>
<p>You can also test storage in simulation tests; check out <a href="https://github.com/near-examples/simulation-testing">this simulation test example</a> to get started.</p>
<h2><a class="anchor" aria-hidden="true" id="other-ways-to-keep-costs-down"></a><a href="#other-ways-to-keep-costs-down" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Other ways to keep costs down</h2>
<p>Storing data on-chain isn't cheap for the people running the network, and NEAR passes on this cost to developers. So, how do you, as a developer, keep your costs down? There are two popular approaches:</p>
<ol>
<li>Use a binary serialization format, rather than JSON</li>
<li>Store data off-chain</li>
</ol>
<h3><a class="anchor" aria-hidden="true" id="use-a-binary-serialization-format-rather-than-json"></a><a href="#use-a-binary-serialization-format-rather-than-json" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Use a binary serialization format, rather than JSON</h3>
<p>The core NEAR team maintains a library called <a href="https://borsh.io/">borsh</a>,
which is used automatically when you use <code>near-sdk-rs</code>. Someday, it will probably also be used by <code>near-sdk-as</code>.</p>
<p>Imagine that you want to store an array like <code>[0, 1, 2, 3]</code>. You could serialize it as a string and store it as UTF-8 bytes. This is what <code>near-sdk-as</code> does today. Cutting out spaces, you end up using 9 bytes.</p>
<p>Using borsh, this same array gets saved as 8 bytes:</p>
<pre><code class="hljs">\u0004\u0000\u0000\u0000\u0000\u0001\u0002\u0003
</code></pre>
<p>At first glance, saving 1 byte might not seem significant. But let's look closer.</p>
<p>The first four bytes here, <code>\u0004\u0000\u0000\u0000</code>, tell the serializer that this is a <code>u32</code> array of length <code>4</code> using little-endian encoding. The rest of the bytes are the literal numbers of the array – <code>\u0000\u0001\u0002\u0003</code>. As you serialize more elements, each will add one byte to the data structure. With JSON, each new element requires adding two bytes, to represent both another comma and the number.</p>
<p>In general, Borsh is faster, uses less storage, and costs less gas. Use it if you can.</p>
<h3><a class="anchor" aria-hidden="true" id="store-data-off-chain"></a><a href="#store-data-off-chain" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Store data off-chain</h3>
<p>This is especially important if you are storing user-generated data!</p>
<p>Let's use this <a href="https://github.com/near-examples/guest-book">Guest Book</a> as an example. As implemented today, visitors to the app can sign in with NEAR and leave a message. Their message is stored on-chain.</p>
<p>Imagine this app got very popular, and that visitors started leaving unexpectedly long messages. The contract owner might run out of funding for storage very quickly!</p>
<p>A better strategy could be to store data off-chain. If you want to keep the app decentralized, a popular off-chain data storage solution is <a href="https://ipfs.io/">IPFS</a>. With this, you can represent any set of data with a predictable content address such as:</p>
<pre><code class="hljs">QmYwAPJzv5CZsnA625s3Xf2nemtYgPpHdWEz79ojWnPbdG
</code></pre>
<p>Such a content address could represent a JSON structure or an image or any other type of data. Where does this data get physically stored? You could use <a href="https://filecoin.io/">Filecoin</a> or run your own IPFS server to pin your app's data.</p>
<p>With this approach, each record you add to your contract will be a predictable size.</p>
<h2><a class="anchor" aria-hidden="true" id="summary"></a><a href="#summary" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Summary</h2>
<p>NEAR's structure incentivizes network operators while giving flexibility and predictability to contract developers. Managing storage is an important aspect of smart contract design, and NEAR's libraries make it easy to figure out how much storage will cost for your application.</p>
<blockquote>
<p>Got a question?
<a href="https://stackoverflow.com/questions/tagged/nearprotocol">
<h8>Ask it on StackOverflow!</h8></a></p>
</blockquote>
</span></div></article></div><div class="docLastUpdate"><em>Last updated on 2021/2/6 by Josh Ford</em></div><div class="docs-prevnext"><a class="docs-prev button" href="https://docs.near.org.cn/docs/concepts/data-storage"><span class="arrow-prev">← </span><span>Data Storage</span></a><a class="docs-next button" href="https://docs.near.org.cn/docs/concepts/epoch"><span>Epoch</span><span class="arrow-next"> →</span></a></div></div></div><nav class="onPageNav"><ul class="toc-headings"><li><a href="#how-does-nears-design-align-incentives">How does NEAR's design align incentives?</a></li><li><a href="#when-do-tokens-get-staked">When do tokens get staked?</a></li><li><a href="#the-million-cheap-data-additions-attack">The &quot;million cheap data additions&quot; attack</a></li><li><a href="#btw-you-can-remove-data-to-unstake-some-tokens">btw, you can remove data to unstake some tokens</a></li><li><a href="#how-much-does-it-cost">How much does it cost?</a></li><li><a href="#example-cost-breakdown">Example cost breakdown</a></li><li><a href="#calculate-costs-for-your-own-contract">Calculate costs for your own contract</a></li><li><a href="#other-ways-to-keep-costs-down">Other ways to keep costs down</a><ul class="toc-headings"><li><a href="#use-a-binary-serialization-format-rather-than-json">Use a binary serialization format, rather than JSON</a></li><li><a href="#store-data-off-chain">Store data off-chain</a></li></ul></li><li><a href="#summary">Summary</a></li></ul></nav></div><footer class="relative pt-100 pb-40 md:pb-100 bg-black text-white mt-150"><div class="absolute pin-t pin-r" style="max-width:50vw"><img src="https://near.org/wp-content/themes/near-19/assets/img/neue/distortion-footer.svg?t=1600963469" class="locked" style="transform:translateY(-60%)" alt=""/></div><div class="container"><div class="row"><div class="col md:w-1/4"><img src="https://near.org/wp-content/themes/near-19/assets/img/neue/logomark-white.svg?t=1600963474" class="locked" width="91" alt=""/><ul class="list-reset text-24 font-black text-yellow mt-50"><li><a href="https://wallet.testnet.near.org/" class="hover:text-white">Wallet</a></li><li><a href="https://explorer.near.org/" class="hover:text-white">Explorer</a></li><li><a href="https://near.dev/" class="hover:text-white">Examples</a></li></ul></div><div class="col md:w-3/4 mt-50 md:mt-0"><ul class="list-reset flex flex-wrap -mx-20"><li class="mx-20"><a href="https://gov.near.org" class="block hover:text-discourse" target="_blank" id="discourse-1"><span class="icon icon-36"><svg enable-background="new 0 0 34 35" viewBox="0 0 34 35" xmlns="http://www.w3.org/2000/svg"><path d="m0 25.1c0-2.6 0-5.2 0-7.8 0-4.7 1.8-8.8 5.2-12.1 2.6-2.5 5.8-4 9.4-4.5 6.9-1.1 13.7 2.3 17.2 8.4 1.6 3 2.4 6.2 2.2 9.5-.4 4.6-2.3 8.5-5.7 11.6-2.5 2.2-5.4 3.6-8.6 4.1-.6.1-1.3.2-2 .2-5.7 0-11.4 0-17.1 0-.4 0-.5-.1-.5-.5-.1-3-.1-6-.1-8.9zm16.9-17.3c-.6 0-1.2.1-1.8.2-6.2 1.3-9.6 8.1-6.7 13.7.1.3.1.5.1.7-.5 1.6-1 3.2-1.4 4.7-.1.1-.1.3-.1.4.1.1.3 0 .4-.1 1.7-.4 3.4-.9 5.1-1.3.3-.1.6-.1.9.1 1.6.7 3.4.9 5.1.6 5.2-.8 8.9-5.7 8.1-11-.8-4.5-4.8-8-9.7-8z"></path></svg></span><span class="screen-reader-text">Forum</span></a></li><li class="mx-20"><a href="https://twitter.com/nearprotocol" class="block hover:text-twitter" target="_blank"><span class="icon icon-36 "><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path d="M459.37 151.716c.325 4.548.325 9.097.325 13.645 0 138.72-105.583 298.558-298.558 298.558-59.452 0-114.68-17.219-161.137-47.106 8.447.974 16.568 1.299 25.34 1.299 49.055 0 94.213-16.568 130.274-44.832-46.132-.975-84.792-31.188-98.112-72.772 6.498.974 12.995 1.624 19.818 1.624 9.421 0 18.843-1.3 27.614-3.573-48.081-9.747-84.143-51.98-84.143-102.985v-1.299c13.969 7.797 30.214 12.67 47.431 13.319-28.264-18.843-46.781-51.005-46.781-87.391 0-19.492 5.197-37.36 14.294-52.954 51.655 63.675 129.3 105.258 216.365 109.807-1.624-7.797-2.599-15.918-2.599-24.04 0-57.828 46.782-104.934 104.934-104.934 30.213 0 57.502 12.67 76.67 33.137 23.715-4.548 46.456-13.32 66.599-25.34-7.798 24.366-24.366 44.833-46.132 57.827 21.117-2.273 41.584-8.122 60.426-16.243-14.292 20.791-32.161 39.308-52.628 54.253z"></path></svg></span><span class="screen-reader-text">Twitter</span></a></li><li class="mx-20"><a href="https://github.com/near" class="block hover:text-github" target="_blank"><span class="icon icon-36 "><svg height="36" viewBox="0 0 36 36" width="36" xmlns="http://www.w3.org/2000/svg"><path d="m17.9991429 0c-9.93942861 0-17.9991429 8.058-17.9991429 18.0008571 0 7.9517143 5.15742857 14.6982858 12.3102857 17.0794286.9.1645714 1.2291429-.3908571 1.2291429-.8682857 0-.4268571-.0162857-1.5591429-.0248572-3.0608571-5.0065714 1.0868571-6.06342854-2.4137143-6.06342854-2.4137143-.81857143-2.0785715-1.99885715-2.6322857-1.99885715-2.6322857-1.63371428-1.1177143.12428572-1.0937143.12428572-1.0937143 1.806.1268571 2.75742857 1.8548571 2.75742857 1.8548571 1.60542857 2.7505714 4.2128571 1.956 5.238 1.4948572.1628571-1.1631429.6282857-1.956 1.1425714-2.406-3.9968571-.4542858-8.1985714-1.9988572-8.1985714-8.8962858 0-1.9654285.70114286-3.5717142 1.85228571-4.83-.18514285-.456-.80314285-2.28514281.17657143-4.76399996 0 0 1.51114286-.48342857 4.94999996 1.84542857 1.4357143-.39942857 2.9751429-.59914285 4.506-.606 1.5282858.00685715 3.0685715.20657143 4.5068572.606 3.4362857-2.32885714 4.944-1.84542857 4.944-1.84542857.9831428 2.47885715.3651428 4.30799996.1791428 4.76399996 1.1545715 1.2582858 1.8505715 2.8645715 1.8505715 4.83 0 6.9154286-4.2085715 8.436-8.2182857 8.8825715.6462857.5554285 1.2214285 1.6534285 1.2214285 3.3325714 0 2.4068571-.0214285 4.3482857-.0214285 4.938 0 .4817143.324 1.0414286 1.2377142.8657143 7.146-2.3845714 12.2991429-9.1277143 12.2991429-17.0768572 0-9.9428571-8.0597143-18.0008571-18.0008571-18.0008571"></path></svg></span><span class="screen-reader-text">GitHub</span></a></li><li class="mx-20"><a href="http://near.chat" class="block hover:text-discord" target="_blank"><span class="icon icon-36 "><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path d="M297.216 243.2c0 15.616-11.52 28.416-26.112 28.416-14.336 0-26.112-12.8-26.112-28.416s11.52-28.416 26.112-28.416c14.592 0 26.112 12.8 26.112 28.416zm-119.552-28.416c-14.592 0-26.112 12.8-26.112 28.416s11.776 28.416 26.112 28.416c14.592 0 26.112-12.8 26.112-28.416.256-15.616-11.52-28.416-26.112-28.416zM448 52.736V512c-64.494-56.994-43.868-38.128-118.784-107.776l13.568 47.36H52.48C23.552 451.584 0 428.032 0 398.848V52.736C0 23.552 23.552 0 52.48 0h343.04C424.448 0 448 23.552 448 52.736zm-72.96 242.688c0-82.432-36.864-149.248-36.864-149.248-36.864-27.648-71.936-26.88-71.936-26.88l-3.584 4.096c43.52 13.312 63.744 32.512 63.744 32.512-60.811-33.329-132.244-33.335-191.232-7.424-9.472 4.352-15.104 7.424-15.104 7.424s21.248-20.224 67.328-33.536l-2.56-3.072s-35.072-.768-71.936 26.88c0 0-36.864 66.816-36.864 149.248 0 0 21.504 37.12 78.08 38.912 0 0 9.472-11.52 17.152-21.248-32.512-9.728-44.8-30.208-44.8-30.208 3.766 2.636 9.976 6.053 10.496 6.4 43.21 24.198 104.588 32.126 159.744 8.96 8.96-3.328 18.944-8.192 29.44-15.104 0 0-12.8 20.992-46.336 30.464 7.68 9.728 16.896 20.736 16.896 20.736 56.576-1.792 78.336-38.912 78.336-38.912z"></path></svg></span><span class="screen-reader-text">Discord</span></a></li><li class="mx-20"><a href="https://t.me/cryptonear" class="block hover:text-telegram" target="_blank"><span class="icon icon-36 "><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><path d="M248 8C111 8 0 119 0 256s111 248 248 248 248-111 248-248S385 8 248 8zm121.8 169.9l-40.7 191.8c-3 13.6-11.1 16.9-22.4 10.5l-62-45.7-29.9 28.8c-3.3 3.3-6.1 6.1-12.5 6.1l4.4-63.1 114.9-103.8c5-4.4-1.1-6.9-7.7-2.5l-142 89.4-61.2-19.1c-13.3-4.2-13.6-13.3 2.8-19.7l239.1-92.2c11.1-4 20.8 2.7 17.2 19.5z"></path></svg></span><span class="screen-reader-text">Telegram</span></a></li><li class="mx-20"><a href="https://near.org/wechat" class="block hover:text-wechat" target="_blank"><span class="icon icon-36 "><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 576 512"><path d="M385.2 167.6c6.4 0 12.6.3 18.8 1.1C387.4 90.3 303.3 32 207.7 32 100.5 32 13 104.8 13 197.4c0 53.4 29.3 97.5 77.9 131.6l-19.3 58.6 68-34.1c24.4 4.8 43.8 9.7 68.2 9.7 6.2 0 12.1-.3 18.3-.8-4-12.9-6.2-26.6-6.2-40.8-.1-84.9 72.9-154 165.3-154zm-104.5-52.9c14.5 0 24.2 9.7 24.2 24.4 0 14.5-9.7 24.2-24.2 24.2-14.8 0-29.3-9.7-29.3-24.2.1-14.7 14.6-24.4 29.3-24.4zm-136.4 48.6c-14.5 0-29.3-9.7-29.3-24.2 0-14.8 14.8-24.4 29.3-24.4 14.8 0 24.4 9.7 24.4 24.4 0 14.6-9.6 24.2-24.4 24.2zM563 319.4c0-77.9-77.9-141.3-165.4-141.3-92.7 0-165.4 63.4-165.4 141.3S305 460.7 397.6 460.7c19.3 0 38.9-5.1 58.6-9.9l53.4 29.3-14.8-48.6C534 402.1 563 363.2 563 319.4zm-219.1-24.5c-9.7 0-19.3-9.7-19.3-19.6 0-9.7 9.7-19.3 19.3-19.3 14.8 0 24.4 9.7 24.4 19.3 0 10-9.7 19.6-24.4 19.6zm107.1 0c-9.7 0-19.3-9.7-19.3-19.6 0-9.7 9.7-19.3 19.3-19.3 14.5 0 24.4 9.7 24.4 19.3.1 10-9.9 19.6-24.4 19.6z"></path></svg></span><span class="screen-reader-text">WeChat</span></a></li><li class="mx-20"><a href="https://www.youtube.com/channel/UCuKdIYVN8iE3fv8alyk1aMw" class="block hover:text-youtube" target="_blank"><span class="icon icon-36 "><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 576 512"><path d="M549.655 124.083c-6.281-23.65-24.787-42.276-48.284-48.597C458.781 64 288 64 288 64S117.22 64 74.629 75.486c-23.497 6.322-42.003 24.947-48.284 48.597-11.412 42.867-11.412 132.305-11.412 132.305s0 89.438 11.412 132.305c6.281 23.65 24.787 41.5 48.284 47.821C117.22 448 288 448 288 448s170.78 0 213.371-11.486c23.497-6.321 42.003-24.171 48.284-47.821 11.412-42.867 11.412-132.305 11.412-132.305s0-89.438-11.412-132.305zm-317.51 213.508V175.185l142.739 81.205-142.739 81.201z"></path></svg></span><span class="screen-reader-text">YouTube</span></a></li></ul><div class="row"><div class="col sm:w-1/3 mt-50"><h2 class="text-24 font-black text-blue-light">Developers</h2><ul id="menu-developers-1" class="footer-menu list-reset mt-5 text-16 md:text-18"><li class="menu-item menu-item-type-post_type menu-item-object-page menu-item-550"><a href="https://near.org/developers/">Overview</a></li><li class="menu-item menu-item-type-post_type menu-item-object-page menu-item-2801"><a href="https://near.org/technology/">Technology</a></li><li class="menu-item menu-item-type-custom menu-item-object-custom menu-item-116"><a target="_blank" rel="noopener noreferrer" href="https://github.com/near" id="github">GitHub</a></li><li class="menu-item menu-item-type-post_type menu-item-object-page menu-item-4720"><a href="https://near.org/bounties/">Bounties</a></li><li class="menu-item menu-item-type-custom menu-item-object-custom menu-item-580"><a href="https://near.org/grants/">Grants</a></li></ul></div><div class="col sm:w-1/3 mt-50"><h2 class="text-24 font-black text-blue-light">Community</h2><ul id="menu-community-1" class="footer-menu list-reset mt-5 text-16 md:text-18"><li class="menu-item menu-item-type-custom menu-item-object-custom menu-item-6804"><a href="https://gov.near.org/">Forum</a></li><li class="menu-item menu-item-type-custom menu-item-object-custom menu-item-4650"><a href="https://near.org/events">Events</a></li><li class="menu-item menu-item-type-post_type menu-item-object-page menu-item-2045"><a href="https://near.org/contributor/">Contributor Program</a></li><li class="menu-item menu-item-type-post_type menu-item-object-page menu-item-4157"><a href="https://near.org/guilds/">Guild Program</a></li><li class="menu-item menu-item-type-custom menu-item-object-custom menu-item-2945"><a target="_blank" rel="noopener noreferrer" href="https://openwebcollective.com">Startup Accelerator</a></li><li class="menu-item menu-item-type-post_type menu-item-object-page menu-item-4719"><a href="https://near.org/bounties/">Bounties</a></li><li class="menu-item menu-item-type-post_type menu-item-object-page menu-item-7161"><a href="https://near.org/tokens/">Tokens</a></li></ul></div><div class="col sm:w-1/3 mt-50"><h2 class="text-24 font-black text-blue-light">About</h2><ul id="menu-about-1" class="footer-menu list-reset mt-5 text-16 md:text-18"><li class="menu-item menu-item-type-post_type menu-item-object-page menu-item-441"><a href="https://near.org/team/">Team</a></li><li class="menu-item menu-item-type-post_type menu-item-object-page menu-item-124"><a href="https://near.org/careers/">Careers</a></li><li class="menu-item menu-item-type-post_type menu-item-object-page menu-item-400"><a href="https://near.org/backers/">Backers</a></li><li class="menu-item menu-item-type-custom menu-item-object-custom menu-item-3490"><a href="https://near.org/downloads/NEAR_PressKit.zip">Press Kit</a></li><li class="menu-item menu-item-type-post_type menu-item-object-page menu-item-2419"><a href="https://near.org/brand/">Brand Guidelines</a></li><li class="menu-item menu-item-type-post_type menu-item-object-page menu-item-3267"><a href="https://near.org/privacy/">Privacy Policy</a></li></ul></div></div></div></div><p class="text-14 mt-50 md:mt-100">2020 NEAR Protocol<span class="mx-10">|</span>All rights reserved<span class="mx-10">|</span><a href="mailto:hello@near.org" class="hover:text-yellow">hello@near.org</a><span class="mx-10">|</span><a href="https://near.org/privacy/" class="hover:text-yellow">Privacy Policy</a></p></div></footer></div><script type="text/javascript" src="https://cdn.jsdelivr.net/docsearch.js/1/docsearch.min.js"></script><script>
                document.addEventListener('keyup', function(e) {
                  if (e.target !== document.body) {
                    return;
                  }
                  // keyCode for '/' (slash)
                  if (e.keyCode === 191) {
                    const search = document.getElementById('search_input_react');
                    search && search.focus();
                  }
                });
              </script><script>
              var search = docsearch({
                
                apiKey: '058929d1d423f0f46d3278a102d58bfd',
                indexName: 'near',
                inputSelector: '#search_input_react'
              });
            </script></body></html>